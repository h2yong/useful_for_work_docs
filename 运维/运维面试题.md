# 运维面试题

## LVS、Nginx、HAproxy 有什么区别

| 类别    | 说明                                                                           |
| ------- | ------------------------------------------------------------------------------ |
| LVS     | 基于四层的转发，只能做端口的转发，基于 URL 的、基于目录的这种转发 LVS 就做不了 |
| HAproxy | 基于四层和七层的转发，是专业的代理服务器                                       |
| Nginx   | WEB 服务器，缓存服务器，又是反向代理服务器，可以做七层的转发                   |

## 什么叫 CDN

- 即内容分发网络
- 其目的是通过在现有的 Internet 中增加一层新的网络架构，将网站的内容发布到最接近用户的网络边缘，使用户可就近取得所需的内容，提高用户访问网站的速度

## DNS 进行域名解析的过程

用户要访问www.baidu.com，会先找本机的host文件，再找本地设置的DNS服务器，如果也没有的话，就去网络中找根服务器，根服务器反馈结果，说只能提供一级域名服务器.cn，就去找一级域名服务器，一级域名服务器说只能提供二级域名服务器.com.cn,就去找二级域名服务器，二级域服务器只能提供三级域名服务器.baidu.com.cn，就去找三级域名服务器，三级域名服务器正好有这个网站www.baidu.com，然后发给请求的服务器，保存一份之后，再发给客户端

## 如何修改 LINUX 的 IP 地址、网关和主机名

A. 修改 IP 地址、网关：编辑/etc/sysconfig/network-scripts/ifcfg-eth0，修改里面 IPADDR 和 GATEWAY 内容，没有这两行，则添加即可，添加时确保 BOOTPROTO=static，静态地址，如 IPADDR=192.168.1.100 GATEWAY=192.168.1.1  
B. 修改主机名称：编辑/etc/sysconfig/network，修改里面的 HOSTNAME 内容，如设置主机名称为 mysql，则：HOSTNAME=mysql 即可；

## 显示/test 目录下的所有目录

- `ls -d */`
- `find . -type d -maxdepth 1`
- `ls -F | grep '/'`
- `ls -l | grep '^d'|awk '{print9}'`

## 如何查看某进程所打开的所有文件

取出该进程的进程号，然后用 lsof -p pid 查看打开的所有文件

## 请用 iptables 控制来自 192.168.1.1 主机的 80 端口请求

`iptables -A INPUT -p tcp -s 192.168.1.2 –dport 80 -j ACCEPT` (允许来自 192.168.1.2 这台主机访问 80 端口)

## mysql 客户端查询工具中，如何获取当前的所有连接进程信息？

参考答案：  
`show full processlist`

## mysql 如何查询数据库当前设置的最大连接数？

参考答案：

```sql
mysql> show variables like '%max_connections%';
+-----------------+-------+
| Variable_name   | Value |
+-----------------+-------+
| max_connections | 1000  |
+-----------------+-------+
```

## Mysql 查看当前连接数（连接总数、活跃数、最大并发数）

```sql
mysql> show status like 'Threads%';
+-------------------+-------+
| Variable_name     | Value |
+-------------------+-------+
| Threads_cached    | 58    |
| Threads_connected | 57    |   ###这个数值指的是打开的连接数
| Threads_created   | 3676  |
| Threads_running   | 4     |   ###这个数值指的是激活的连接数，这个数值一般远低于connected数值
+-------------------+-------+
```

Threads_connected 跟 show processlist 结果相同，表示当前连接数。准确的来说 Threads_running 是代表当前并发数

## chmod 755 a.txt，755 代表什么权限？

参考答案：  
755 的权限就是：rwxr-xr-x。第一位 7 等于 4+2+1，所以就是 rwx，所有者有读取、写入、执行的权限；第二位 5 也是 4+0+1，r-x，同组用户具有读取、执行权限；第三位 5，代表公共用户有读取、执行的权限。

## umask 022 代表什么意思

umask 022 表示默认创建新文件权限为 777-022=755

## 匹配 AAA 文本中的 key 并打印出该行及下面的 5 行？

```sh
grep -A 5 key AAA
```

注：-A 是查找关键词下面的行，-B 是查找关键词上面的行，-C 是上下的行，注意这里是 grep，而不是 find。

## top 和 ps 命令在进程占有资源率的统计方式有什么不同？

ps 命令是显示在执行 ps 这个命令时刻所有进程的情况，而 top 是动态的监控进程的情况。  
top 命令显示系统总的统计信息，比如时间、CPU 情况、 内存状态和分区信息等等。  
ps -ef 这个是一个比较常见的搭配方式，-e 是所有进程，-f 是文件之间的关系。  
ps -aux 也是很常用的，意思是显示包含其他使用者的进程。ps 命令也可以搭配 -more 和管道符使用，也可以搭配输出重定向。  
top -n 2 指的是更新两次之后就停；top -d 3 指的是更新周期是三秒；top -p 574 指的是显示 pid 为 574 的进程。top 状态下按 b 是显示高亮。

## 符号链接与硬链接的区别？

硬链接是复制，享用同一个 inode，不能跨分区，不能连目录，a 变 b 也变，但是 a 删 b 不删。
符号链接就是 -s，不享用同一个 inode，可以跨分区可以连目录，等于快捷方式。

## 什么是正向代理和反向代理？

- 正向代理就是一个人发送一个请求直接就到达了目标的服务器
- 反方代理就是请求统一被 Nginx 接收，nginx 反向代理服务器接收到之后，按照一定的规 则分发给了后端的业务处理服务器进行处理了

## 如何用 Nginx 解决前端跨域问题？

- 使用 Nginx 转发请求。把跨域的接口写成调本域的接口，然后将这些接口转发到真正的请求地址。

## nginx location 的作用是什么？

答案参考：location 指令的作用是根据用户请求的 URI 来执行不同的应用，也就是根据用户请求的网站 URL 进行匹配，匹配成功即进行相关的操作。

K8S相关：
1.Kubernetes Architecture必要节点有哪些？在这些节点上部署的内置组件都有哪些，简述下各个组件的作用.
	Answer :  Kubernetes Architecture主要有两个种节点类型 - 主节点和工作节点。
		主节点内置组件有：
			1.ApiServer：以REST API服务形式提供接口，作为整个系统的控制入口
			2.Scheduler：负责节点资源管理和调度，接收来自kube-apiserver创建Pods任务，并分配到某个节点
			3.ETCD：负责节点间的服务发现和配置共享。
			4.ControllerManager：执行整个系统的后台任务，包括节点状态状况、Pod个数、Pods和Service的关联等
		工作节点内置组件有：
			1.kube-proxy:运行在每个计算节点上，负责Pod网络代理。定时从etcd获取到service信息来做相应的策略。
			2.kubelet:运行在每个计算节点上，作为agent，接收分配该节点的Pods任务及管理容器，周期性获取容器状态，反馈给kube-apiserver。
			3.DNS：一个可选的DNS服务，用于为每个Service对象创建DNS记录，这样所有的Pod就可以通过DNS访问服务了。
2.什么是Ingress网络，它是如何工作的？
	Answer：Ingress网络是一组规则，充当Kubernetes集群的入口点。这允许入站连接，可以将其配置为通过可访问的URL，负载平衡流量或通过提供基于名称的虚拟主机从外部提供服务。因此，Ingress是一个API对象，通常通过HTTP管理集群中服务的外部访问，是暴露服务的最有效方式。

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------	Ansible相关：
	1.系统由控制主机对被管节点的操作方式有几种模式，简单介绍下。
	Answer :  
		ad-hoc模式(点对点模式)：使用单个模块，支持批量执行单条命令。ad-hoc 命令是一种可以快速输入的命令，而且不需要保存起来的命令。就相当于bash中的一句话shell。
		playbook模式(剧本模式)：Ansible主要管理方式，也是Ansible功能强大的关键所在。playbook通过多个task集合完成一类功能，如Web服务的安装部署、数据库服务器的批量备份等。可以简单地把playbook理解为通过组合多条ad-hoc操作的配置文件。

	2.Ansible执行流程？
	 首先读取ansible.cfg中的配置， 根据规则获取Inventory中的管理主机列表， 并行的在这些主机中执行配置的任务， 最后等待执行返回的结果
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Docker相关：
	1.四类网络模式：
	host模式	–net=host ：容器和宿主机共享Network namespace。
	container模式	–net=container:NAME_or_ID	容器和另外一个容器共享Network namespace。 kubernetes中的pod就是多个容器共享一个Network namespace。
	none模式	–net=none	容器有独立的Network namespace，但并没有对其进行任何网络设置，如分配veth pair 和网桥连接，配置IP等。
	bridge模式	–net=bridge	（默认为该模式）

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Zabbix和Prometheus区别以及应用场景：
	Answer：1.从数据存储方面来看，Zabbix采用关系数据库保存，这极大限制了Zabbix采集的性能，而Prometheus自研一套高性能的时序数据库，在V3版本可以达到每秒千万级别的数据存储，通过对接第三方时序数据库扩展历史数据的存储
		2.从配置复杂度上看，Prometheus只有一个核心server组件，一条命令便可以启动，相比而言，Zabbix配置相对麻烦
		3.从容器支持角度看，由于Zabbix出现得比较早，当时容器还没有诞生，自然对容器的支持也比较差。而Prometheus的动态发现机制，不仅可以支持swarm原生集群，还支持Kubernetes容器集群的监控，是目前容器监控最好解决方案。
