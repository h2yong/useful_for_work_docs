# 消息队列面试指南
## 什么时候重复消费？
例如天猫下单成功消息推送到了MQ，优惠券/积分/库存等系统都订阅了此MQ信息。但库存扣减失败抛出异常要求重新发一次消息。优惠券/积分消费是成功的，消息重发后造成了重复消费。

## 如何保证？
下游处理接口采用幂等处理。  
例如上述场景可以先判断订单是否处理过，处理过直接return不处理。

## 你们有接触过消息顺序消费这样的场景么？你怎么保证的？
数据库同时对一个Id的数据进行了增、改、删三个操作，但是你消息发过去消费的时候变成了改，删、增，这样数据就不对了。  
Kafka分布式的单位是partition，同一个partition用一个write ahead log组织，所以可以保证FIFO的顺序。不同partition之间不能保证顺序。

## 什么是事务？
事务是恢复和并发控制的基本单位。  
事务应该具有4个属性：原子性、一致性、隔离性、持久性。这四个属性通常称为ACID特性。
* 原子性（atomicity）：一个事务是一个不可分割的工作单位，事务中包括的操作要么都做，要么都不做。
* 一致性（consistency）：事务必须是使数据库从一个一致性状态变到另一个一致性状态。一致性与原子性是密切相关的。
* 隔离性（isolation）：一个事务的执行不能被其他事务干扰。即一个事务内部的操作及使用的数据对并发的其他事务是隔离的，并发执行的各个事务之间不能互相干扰。
* 持久性（durability）：持久性也称永久性（permanence），指一个事务一旦提交，它对数据库中数据的改变就应该是永久性的。接下来的其他操作或故障不应该对其有任何影响。

事务就是一系列操作，要么同时成功，要么同时失败。然后会从事务的 ACID 特性（原子性、一致性、隔离性、持久性）展开叙述。